(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{558:function(t,a,s){"use strict";s.r(a);var e=s(6),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("最新版本的ntp配置变化了很多，找了一些文档，全是乱七八糟的文章内容（万恶的X度），踩了不少坑最后才配置好。")]),t._v(" "),s("h2",{attrs:{id:"安装ntp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装ntp"}},[t._v("#")]),t._v(" 安装ntp")]),t._v(" "),s("p",[t._v("首先安装ntp同步工具")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntp ntpdate -y\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"修改时区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改时区"}},[t._v("#")]),t._v(" 修改时区")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("timedatectl set-timezone Asia/Shanghai\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"配置ntp同步服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置ntp同步服务器"}},[t._v("#")]),t._v(" 配置ntp同步服务器")]),t._v(" "),s("p",[t._v("打开ntp配置文件:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo vim /etc/ntp.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("找到下方的位置行，大概在20行，将它们注释掉：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#pool 0.ubuntu.pool.ntp.org iburst\n#pool 1.ubuntu.pool.ntp.org iburst\n#pool 2.ubuntu.pool.ntp.org iburst\n#pool 3.ubuntu.pool.ntp.org iburst\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("接下来添加你们想要同步的目标服务器，例如我有个时间服务器配置到了ip为"),s("code",[t._v("192.168.98.180")]),t._v("上（其中prefer表示优先主机）：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server 192.168.98.180 prefer\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("后面加"),s("code",[t._v("iburst")]),t._v("是为了能在启动的时候能先同步一次，而不用等待第一个时间周期后才进行同步处理。\n如果你还想增加一个备用的时间服务器可以在后面继续添加一个，这个顺序很重要，排到前面的优先级高，例如：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 主时间服务地址\nserver 192.168.98.180 prefer\n# 备用时间服务地址\nserver ntp.ubuntu.com iburst\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h2",{attrs:{id:"查看同步效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看同步效果"}},[t._v("#")]),t._v(" 查看同步效果")]),t._v(" "),s("p",[t._v("可以通过"),s("code",[t._v("ntpq -p")]),t._v("命令来查看：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("     remote           refid      st t when poll reach   delay   offset  jitter\n==============================================================================\nxminieye.lan     LOCAL(0)         6 u   45   64  377    0.442   29.413   5.080\nxchilipepper.can 145.238.203.14   2 u   42   64  377  290.323  1095849  24.501\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h3",{attrs:{id:"表头"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表头"}},[t._v("#")]),t._v(" 表头")]),t._v(" "),s("ul",[s("li",[t._v("remote – 用于同步的远程节点或服务器。“LOCAL”表示本机 （当没有远程服务器可用时会出现）")]),t._v(" "),s("li",[t._v("refid – 远程的服务器进行同步的更高一级服务器")]),t._v(" "),s("li",[t._v("st – 远程节点或服务器的 Stratum（级别，NTP 时间同步是分层的）")]),t._v(" "),s("li",[t._v("t – 类型 (u: unicast（单播） 或 manycast（选播） 客户端, b: broadcast（广播） 或 multicast（多播） 客户端, l: 本地时钟, s: 对称节点（用于备份）, A: 选播服务器, B: 广播服务器, M: 多播服务器, 参见“Automatic Server Discovery“)")]),t._v(" "),s("li",[t._v("when – 最后一次同步到现在的时间 (默认单位为秒, “h”表示小时，“d”表示天)")]),t._v(" "),s("li",[t._v("poll – 同步的频率：rfc5905建议在 NTPv4 中这个值的范围在 4 (16秒) 至 17 (36小时) 之间（即2的指数次秒），然而观察发现这个值的实际大小在一个小的多的范围内 ：64 (26 )秒 至 1024 (210 )秒")]),t._v(" "),s("li",[t._v("reach – 一个8位的左移移位寄存器值，用来测试能否和服务器连接，每成功连接一次它的值就会增加，以 8 进制显示")]),t._v(" "),s("li",[t._v("delay – 从本地到远程节点或服务器通信的往返时间（毫秒）")]),t._v(" "),s("li",[t._v("offset – 主机与远程节点或服务器时间源的时间偏移量，offset 越接近于0，主机和 NTP 服务器的时间越接近(以方均根表示，单位为毫秒)")]),t._v(" "),s("li",[t._v("jitter – 与远程节点同步的时间源的平均偏差（多个时间样本中的 offset 的偏差，单位是毫秒），这个数值的绝对值越小，主机的时间就越精确")])]),t._v(" "),s("h3",{attrs:{id:"remote的状态标识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remote的状态标识"}},[t._v("#")]),t._v(" remote的状态标识")]),t._v(" "),s("p",[t._v('第一列中的第一个字符是状态标识（参见 Peer Status Word），包含 " "，"x"，"-"，"#"，"+"，"*"，"o"。')]),t._v(" "),s("ul",[s("li",[t._v('" " – 无状态，表示:没有远程通信的主机，LOCAL" 即本机，（未被使用的）高层级服务器，远程主机使用的这台机器作为同步服务器')]),t._v(" "),s("li",[t._v("“x” – 已不再使用")]),t._v(" "),s("li",[t._v("“-” – 已不再使用")]),t._v(" "),s("li",[t._v("“#” – 良好的远程节点或服务器但是未被使用 （不在按同步距离排序的前六个节点中，作为备用节点使用）")]),t._v(" "),s("li",[t._v("“+” – 良好的且优先使用的远程节点或服务器（包含在组合算法中）")]),t._v(" "),s("li",[t._v("“*” – 当前作为优先主同步对象的远程节点或服务器")]),t._v(" "),s("li",[t._v("“o” – PPS 节点 (当优先节点是有效时)。实际的系统同步是源于秒脉冲信号（pulse-per-second，PPS），可能通过PPS 时钟驱动或者通过内核接口。")])]),t._v(" "),s("h3",{attrs:{id:"refid的含义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#refid的含义"}},[t._v("#")]),t._v(" refid的含义")]),t._v(" "),s("ul",[s("li",[t._v("一个IP地址 – 远程节点或服务器的 IP 地址")]),t._v(" "),s("li",[t._v(".LOCL. – 本机 (当没有远程节点或服务器可用时）")]),t._v(" "),s("li",[t._v(".PPS. – 时间标准中的“Pulse Per Second”（秒脉冲）")]),t._v(" "),s("li",[t._v(".IRIG. – Inter-Range Instrumentation Group 时间码")]),t._v(" "),s("li",[t._v(".ACTS. – 美国 NIST 标准时间 电话调制器")]),t._v(" "),s("li",[t._v(".NIST. –美国 NIST 标准时间电话调制器")]),t._v(" "),s("li",[t._v(".PTB. – 德国 PTB 时间标准电话调制器")]),t._v(" "),s("li",[t._v(".USNO. – 美国 USNO 标准时间 电话调制器")]),t._v(" "),s("li",[t._v(".CHU. – CHU (HF, Ottawa, ON, Canada) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".DCFa. – DCF77 (LF, Mainflingen, Germany) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".HBG. – HBG (LF Prangins, Switzerland) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".JJY. – JJY (LF Fukushima, Japan) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".LORC. – LORAN-C station (MF) 标准时间无线电接收器，注： 不再可用 (被 eLORAN 废弃)")]),t._v(" "),s("li",[t._v(".MSF. – MSF (LF, Anthorn, Great Britain) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".TDF. – TDF (MF, Allouis, France)标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".WWV. – WWV (HF, Ft. Collins, CO, America) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".WWVB. – WWVB (LF, Ft. Collins, CO, America) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".WWVH. – WWVH (HF, Kauai, HI, America) 标准时间无线电接收器")]),t._v(" "),s("li",[t._v(".GOES. – 美国静止环境观测卫星;")]),t._v(" "),s("li",[t._v(".GPS. – 美国 GPS;")]),t._v(" "),s("li",[t._v(".GAL. – 伽利略定位系统欧洲 GNSS;")]),t._v(" "),s("li",[t._v(".ACST. – 选播服务器")]),t._v(" "),s("li",[t._v(".AUTH. – 认证错误")]),t._v(" "),s("li",[t._v(".AUTO. – Autokey （NTP 的一种认证机制）顺序错误")]),t._v(" "),s("li",[t._v(".BCST. – 广播服务器")]),t._v(" "),s("li",[t._v(".CRYPT. – Autokey 协议错误")]),t._v(" "),s("li",[t._v(".DENY. – 服务器拒绝访问;")]),t._v(" "),s("li",[t._v(".INIT. – 关联初始化")]),t._v(" "),s("li",[t._v(".MCST. – 多播服务器")]),t._v(" "),s("li",[t._v(".RATE. – (轮询) 速率超出限定")]),t._v(" "),s("li",[t._v(".TIME. – 关联超时")]),t._v(" "),s("li",[t._v(".STEP. – 间隔时长改变，偏移量比危险阈值小(1000ms) 比间隔时间 (125ms)大")])]),t._v(" "),s("h2",{attrs:{id:"常见场景问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见场景问题"}},[t._v("#")]),t._v(" 常见场景问题")]),t._v(" "),s("h3",{attrs:{id:"_1、第一优先级的时间服务器无法访问-它会自动选择备用服务器继续同步吗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、第一优先级的时间服务器无法访问-它会自动选择备用服务器继续同步吗"}},[t._v("#")]),t._v(" 1、第一优先级的时间服务器无法访问，它会自动选择备用服务器继续同步吗？")]),t._v(" "),s("p",[t._v("答：会的")]),t._v(" "),s("h3",{attrs:{id:"_2、第一优先级的时间服务器恢复后-它会自动从备用服务器切换回第一优先级的服务器吗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、第一优先级的时间服务器恢复后-它会自动从备用服务器切换回第一优先级的服务器吗"}},[t._v("#")]),t._v(" 2、第一优先级的时间服务器恢复后，它会自动从备用服务器切换回第一优先级的服务器吗？")]),t._v(" "),s("p",[t._v("答：并不会，需要重启"),s("code",[t._v("ntp")]),t._v("服务，重新进行同步："),s("code",[t._v("sudo systemctl restart ntp")])])])}),[],!1,null,null,null);a.default=r.exports}}]);