(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{562:function(a,s,n){"use strict";n.r(s);var e=n(6),t=Object(e.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"更新源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新源"}},[a._v("#")]),a._v(" 更新源")]),a._v(" "),n("h3",{attrs:{id:"修改之前-备份下配置文件-可选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改之前-备份下配置文件-可选"}},[a._v("#")]),a._v(" 修改之前，备份下配置文件（可选）")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\nsudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h3",{attrs:{id:"修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[a._v("#")]),a._v(" 修改配置")]),a._v(" "),n("p",[a._v("打开"),n("code",[a._v("sudo nano /etc/apt/sources.lis")]),a._v("，修改源配置：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("deb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster main non-free contrib\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main non-free contrib\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main non-free contrib\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("h3",{attrs:{id:"修改raspi-list"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改raspi-list"}},[a._v("#")]),a._v(" 修改raspi.list")]),a._v(" "),n("p",[a._v("打开"),n("code",[a._v("sudo nano /etc/apt/sources.list.d/raspi.list")]),a._v("，修改配置：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("#deb [arch=armhf] http://mirrors.aliyun.com/raspbian/raspbian/ stretch main non-free contrib firmware rpi\n#deb [arch=armhf] http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ stretch main ui\ndeb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h3",{attrs:{id:"更新缓存并升级软件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新缓存并升级软件"}},[a._v("#")]),a._v(" 更新缓存并升级软件")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("sudo apt-get update && apt-get upgrade\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h2",{attrs:{id:"树莓派配置7寸显示屏dsi"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#树莓派配置7寸显示屏dsi"}},[a._v("#")]),a._v(" 树莓派配置7寸显示屏DSI")]),a._v(" "),n("p",[a._v("打开配置文件"),n("code",[a._v("sudo nano /boot/config.txt")]),a._v("，增加以下配置：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("dtoverlay=vc4-kms-v3d\ndtoverlay=vc4-kms-dsi-7inch\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("保存后重启树莓派，即可点亮屏幕。")]),a._v(" "),n("h2",{attrs:{id:"安装基础库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装基础库"}},[a._v("#")]),a._v(" 安装基础库")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("sudo apt install -y git curl cockpit vim ntp ntpdate -y\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h2",{attrs:{id:"docker配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker配置"}},[a._v("#")]),a._v(" docker配置")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("sudo groupadd docker     #添加docker用户组\nsudo gpasswd -a $USER docker     #将登陆用户加入到docker用户组中\nnewgrp docker     #更新用户组\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h2",{attrs:{id:"配置软路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置软路由"}},[a._v("#")]),a._v(" 配置软路由")]),a._v(" "),n("p",[a._v("将旧的树莓派openwrt docker镜像导出，最新版的openwrt docker镜像有问题，会在开机的时候循环进入immortal终端，导致自身的终端无法使用。")]),a._v(" "),n("h3",{attrs:{id:"创建网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建网络"}},[a._v("#")]),a._v(" 创建网络")]),a._v(" "),n("p",[a._v("创建lan口网络")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# 创建lan口网络\ndocker network create -d macvlan --subnet=192.168.98.0/24 --gateway=192.168.98.1 -o parent=eth0 lanet\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h3",{attrs:{id:"启动容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[a._v("#")]),a._v(" 启动容器")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("docker run -d --restart unless-stopped --name openwrt --network lanet --privileged openwrt:v1.0 /sbin/init\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h3",{attrs:{id:"创建桥接网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建桥接网络"}},[a._v("#")]),a._v(" 创建桥接网络")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('# 创建桥接网络\ndocker network create -d bridge  --subnet 192.168.6.0/24 --gateway=192.168.6.254 -o "com.docker.network.bridge.name=br1" wan\ndocker network connect wan openwrt\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h3",{attrs:{id:"修改树莓派网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改树莓派网络"}},[a._v("#")]),a._v(" 修改树莓派网络")]),a._v(" "),n("p",[a._v("新建"),n("code",[a._v("sudo vim /etc/network/interfaces.d/openwrt")]),a._v("配置文件，改成以下：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("auto eth0\nallow-hotplug eth0\niface eth0 inet manual\npre-up ifconfig eth0 promisc\n\nauto macvlan\niface macvlan inet static\n  address 192.168.98.180\n  netmask 255.255.255.0\n  gateway 192.168.98.1\n  dns-nameservers 192.168.98.1\n  pre-up ip link add macvlan link eth0 type macvlan mode bridge\n  post-down ip link del macvlan link eth0 type macvlan mode bridge\n\nauto eth1\nallow-hotplug eth1\niface eth1 inet manual\npre-up ifconfig eth1 promisc\n\nauto eth2\nallow-hotplug eth2\niface eth2 inet manual\npre-up ifconfig eth2 promisc\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br")])]),n("p",[n("code",[a._v("eth0")]),a._v("设置为lan口，跟"),n("code",[a._v("macvlan")]),a._v("桥接到一起，提供给openwrt镜像里面做软路由分配。"),n("code",[a._v("eth1")]),a._v("跟"),n("code",[a._v("eth2")]),a._v("为"),n("code",[a._v("wan")]),a._v("口。")]),a._v(" "),n("h3",{attrs:{id:"修改docker配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改docker配置"}},[a._v("#")]),a._v(" 修改docker配置")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# 进入容器\ndocker exec -it openwrt bash\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("将"),n("code",[a._v("vim /etc/config/network")]),a._v("配置修改成以下：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("config interface 'loopback'\n        option ifname 'lo'\n        option proto 'static'\n        option ipaddr '127.0.0.1'\n        option netmask '255.0.0.0'\n\nconfig globals 'globals'\n        option ula_prefix 'fdd3:60d7:a044::/48'\n\nconfig interface 'lan'\n        option type 'bridge'\n        option ifname 'eth0'\n        option proto 'static'\n        option ipaddr '192.168.98.1'\n        option netmask '255.255.255.0'\n        option gateway '192.168.98.1'\n        option broadcast '192.168.98.255'\n        option dns '192.168.98.1'\n\nconfig interface 'vpn0'\n        option ifname 'tun0'\n        option proto 'none'\n\nconfig interface 'wan'\n        option proto 'static'\n        option ifname 'eth1'\n        option dns '114.114.114.114'\n        option ipaddr '192.168.6.1'\n        option netmask '255.255.255.0'\n        option gateway '192.168.6.254'\n        option broadcast '192.168.6.255'\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br"),n("span",{staticClass:"line-number"},[a._v("26")]),n("br"),n("span",{staticClass:"line-number"},[a._v("27")]),n("br"),n("span",{staticClass:"line-number"},[a._v("28")]),n("br"),n("span",{staticClass:"line-number"},[a._v("29")]),n("br"),n("span",{staticClass:"line-number"},[a._v("30")]),n("br"),n("span",{staticClass:"line-number"},[a._v("31")]),n("br")])]),n("p",[a._v("将"),n("code",[a._v("eth1")]),a._v("定义为"),n("code",[a._v("wan")]),a._v("口，这个"),n("code",[a._v("eth1")]),a._v("就是之前连接的docker网络，这样的话就能将外部网络跟路由器的其他接口连接起来。")]),a._v(" "),n("h3",{attrs:{id:"修改宿主机配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改宿主机配置"}},[a._v("#")]),a._v(" 修改宿主机配置")]),a._v(" "),n("p",[a._v("打开配置文件：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("sudo nano /etc/network/interfaces.d/openwrt\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[a._v("修改为：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("auto eth0\nallow-hotplug eth0\niface eth0 inet manual\npre-up ifconfig eth0 promisc\n\nauto macvlan\niface macvlan inet static\n  address 192.168.98.180\n  netmask 255.255.255.0\n  gateway 192.168.98.1\n  dns-nameservers 192.168.98.1\n  pre-up ip link add macvlan link eth0 type macvlan mode bridge\n  post-down ip link del macvlan link eth0 type macvlan mode bridge\n\nauto eth1\nallow-hotplug eth1\niface eth1 inet manual\npre-up ifconfig eth1 promisc\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);