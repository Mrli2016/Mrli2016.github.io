(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{557:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[s._v("#")]),s._v(" 备份")]),s._v(" "),a("p",[s._v("首先使用fdisk 先查看磁盘分区")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo fdisk -u -l\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("例如我这边的输出结果是：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("......\n\nDisk /dev/mmcblk0: 29.74 GiB, 31914983424 bytes, 62333952 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 9C9A7D47-E91A-4255-8E62-5C9E9288598A\n\nDevice           Start      End  Sectors  Size Type\n/dev/mmcblk0p1    2048  1050623  1048576  512M EFI System\n/dev/mmcblk0p2 1050624 28375848 27325225   13G Linux filesystem\n\n\nDisk /dev/sdb: 29.83 GiB, 32010928128 bytes, 62521344 sectors\nDisk model: Storage Device  \nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 9C9A7D47-E91A-4255-8E62-5C9E9288598A\n\nDevice       Start      End  Sectors  Size Type\n/dev/sdb1     2048  1050623  1048576  512M EFI System\n/dev/sdb2  1050624 62519295 61468672 29.3G Linux filesystem\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("里面的"),a("code",[s._v("/dev/mmcblk0")]),s._v("就是我的系统盘，"),a("code",[s._v("/dev/sdb")]),s._v("是我的备份U盘，而我需要做的就是将其中的"),a("code",[s._v("/dev/mmcblk0p2")]),s._v("备份到"),a("code",[s._v("/dev/sdb2")]),s._v("。")]),s._v(" "),a("p",[s._v("这里需要注意下，我看到很多文章都没提到，如果你直接用这两个磁盘名字去备份的话，会找不到"),a("code",[s._v("/dev/sdb2")]),s._v("这个文件路径，原因是没有挂载这个硬盘，所以我们还得手动将这个目标磁盘挂载到系统文件下面。")]),s._v(" "),a("blockquote",[a("p",[s._v("注意："),a("code",[s._v("/dev/mmcblk0")]),s._v("跟"),a("code",[s._v("/dev/sdb2")]),s._v("只是我这边的磁盘名字，遇到的硬盘名都不一定相同。")])]),s._v(" "),a("h3",{attrs:{id:"挂载备份盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载备份盘"}},[s._v("#")]),s._v(" 挂载备份盘")]),s._v(" "),a("p",[s._v("1、创建挂载文件名，这里建议在"),a("code",[s._v("/media")]),s._v("路径下创建：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo mkdir /media/bk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2、挂载硬盘")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo mount /dev/sdb2 /media/bk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里的备份分全盘备份、分区备份和压缩备份，按个人需求进行选择备份方式。")]),s._v(" "),a("h3",{attrs:{id:"_1、全盘备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、全盘备份"}},[s._v("#")]),s._v(" 1、全盘备份")]),s._v(" "),a("p",[s._v("对整个硬盘进行全盘复制，并不会跳过磁盘未使用的空间。一定要确保输出目标容量比原来的磁盘文件大。\n"),a("code",[s._v("status=progress")]),s._v("参数可以显示备份进度")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dd if=/dev/mmcblk0p2  of=/media/bk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输出目标还可以保存为img文件：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo dd if=/dev/mmcblk0p2 of=/media/bk/ubuntu.img\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2、分区备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、分区备份"}},[s._v("#")]),s._v(" 2、分区备份")]),s._v(" "),a("p",[s._v("指明备份块的大小和数量，进行分区备份，这样的话就不会将空白空间也拷贝进去。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dd bs=512 count=[fdisk命令中最大的end数+1] if=/dev/mmcblk0p2 of=dev/sdb2/disk1.img\n# 如：dd bs=512 count=15002048 if=/dev/mmcblk0p2 of=/media/bk/ubuntu.img\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"查看备份进度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看备份进度"}},[s._v("#")]),s._v(" 查看备份进度")]),s._v(" "),a("p",[s._v("当你输入备份命令后，命令行会一直被阻塞而没有任何提示，这样的话不太友好。")]),s._v(" "),a("ul",[a("li",[s._v("方法一：可以另外开个命令行窗口，对进度进行监听：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo watch -n 5 killall -USR1 dd\n#（注：killall并不是传说中把进程kill掉，而是发送一个指定的信号到指定的进程）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后切换回之前的命令行窗口，就能看到备份情况了")]),s._v(" "),a("ul",[a("li",[s._v("方法二：增加status=progress参数(推荐)\n如：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo dd if=/dev/mmcblk0p2 of=/media/bk/ubuntu.img status=progress\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"备份完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份完成"}},[s._v("#")]),s._v(" 备份完成")]),s._v(" "),a("p",[s._v("取消挂载文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo umount /media/bk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#还原"}},[s._v("#")]),s._v(" 还原")]),s._v(" "),a("p",[s._v("还原的过程就是将目标调换一下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dd if=ubuntu.img of=/dev/sda\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("找个备份好的linux，然后将这个系统镜像写入到新硬盘中。")]),s._v(" "),a("h3",{attrs:{id:"遇到的坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到的坑"}},[s._v("#")]),s._v(" 遇到的坑")]),s._v(" "),a("p",[s._v("我在新的系统中遇到了无法正常初始化网卡的问题，通过"),a("code",[s._v("ifconfig")]),s._v("命令只能看到"),a("code",[s._v("lo")]),s._v("的本地网卡，没看到其他网卡信息。\n其实是能看到的，只要加个"),a("code",[s._v("-a")]),s._v("就出现了：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ifconfig -a\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后启动你想要的网卡：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ifconfig 网卡名 up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动后就能正常看到了，再通过"),a("code",[s._v("ifconfig")]),s._v("就能看到该网卡信息。\n但只是启动了网卡还不行，还需要给它配置网络。这个在Ubuntu20.04中可以通过"),a("code",[s._v("netplan")]),s._v("来管理网络配置，配置文件位于"),a("code",[s._v("/etc/netplan/*")]),s._v("，里面的配置文件通过开头数字来覆盖，所以只要改其中权重最大的配置文件就可以了。\n最简单的配置项：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Let NetworkManager manage all devices on this system\nnetwork:\n  version: 2\n  renderer: NetworkManager\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("最后重启网络"),a("code",[s._v("sudo netplan apply")])])])}),[],!1,null,null,null);e.default=n.exports}}]);