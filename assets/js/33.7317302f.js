(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{563:function(a,s,e){"use strict";e.r(s);var t=e(6),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h2",{attrs:{id:"android上的ssl证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#android上的ssl证书"}},[a._v("#")]),a._v(" Android上的SSL证书")]),a._v(" "),e("h3",{attrs:{id:"android-4-0之前"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#android-4-0之前"}},[a._v("#")]),a._v(" Android 4.0之前")]),a._v(" "),e("p",[a._v("在"),e("code",[a._v("/system/etc/security/cacert.bks")]),a._v("文件中含有所有系统级的CA证书，需要将自己的证书添加到"),e("code",[a._v("cacert.bks")]),a._v("文件里面。")]),a._v(" "),e("h3",{attrs:{id:"在android-4-0-和-6-0-之间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在android-4-0-和-6-0-之间"}},[a._v("#")]),a._v(" 在Android 4.0 和 ６.0 之间")]),a._v(" "),e("p",[a._v("在"),e("code",[a._v("/system/etc/security")]),a._v("目录下的所有证书文件都会被信任。\n但是，用户可以添加自己的用户证书到"),e("code",[a._v("/data/misc/keychain/certs-added")]),a._v("目录。\n在这里，系统证书跟用户证书都被信任，这是最方便的地方。")]),a._v(" "),e("h3",{attrs:{id:"在android-7-0之后"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在android-7-0之后"}},[a._v("#")]),a._v(" 在Android 7.0之后")]),a._v(" "),e("p",[a._v("在这之后，默认情况下系统不再信任用户证书。但是如果是自己的应用，那么可以在AndroidManifeset.xml里配置可以信任用户证书。\n如果是抓包别人的应用，这种情况下是抓不到包的。")]),a._v(" "),e("h2",{attrs:{id:"制作并安装android的系统证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#制作并安装android的系统证书"}},[a._v("#")]),a._v(" 制作并安装Android的系统证书")]),a._v(" "),e("p",[a._v("对于Android 7.0之后的系统，我们想要让系统信任我们的证书，那么我们就得想办法安装证书到Android的系统证书文件下。")]),a._v(" "),e("h3",{attrs:{id:"获得证书的hash值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获得证书的hash值"}},[a._v("#")]),a._v(" 获得证书的hash值")]),a._v(" "),e("p",[a._v("打开下载的"),e("code",[a._v("fiddle")]),a._v("或"),e("code",[a._v("charles")]),a._v("（或者其他抓包工具的pem证书）的pem证书文件路径，在该目录下执行命令获取证书的hash值:")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("openssl x509 -inform PEM -subject_hash_old -in XXX.pem | head -1\n\n# 结果：\n7bd7be8d(charles)\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("注意，要用"),e("code",[a._v("-subject_hash_old")]),a._v("选项，而不是"),e("code",[a._v("-subject_hash")]),a._v("，这样才会得到"),e("code",[a._v("openssl 0.9")]),a._v("兼容的hash值。")]),a._v(" "),e("h3",{attrs:{id:"生成文件名以-0结尾android证书文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成文件名以-0结尾android证书文件"}},[a._v("#")]),a._v(" 生成文件名以.0结尾android证书文件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cat XXX.pem > 7bd7be8d.0\nopenssl x509 -inform PEM -text -in XXX.pem -noout >>  7bd7be8d.0\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h3",{attrs:{id:"最后"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[a._v("#")]),a._v(" 最后")]),a._v(" "),e("p",[a._v("将生成后的"),e("code",[a._v("7bd7be8d.0")]),a._v("证书文件放到"),e("code",[a._v("/system/etc/security/cacerts/")]),a._v("文件目录下即可，这样就能在"),e("code",[a._v("设置")]),a._v("里搜索"),e("code",[a._v('"信任的凭据"')]),a._v("里查看到。\n就能正常抓取https请求了。")])])}),[],!1,null,null,null);s.default=r.exports}}]);