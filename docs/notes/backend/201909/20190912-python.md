---
categories: 
- 后端
tags:
- 后端
- python
date:
- 2019-09-12
---

# python使用cfg配置文件

## 应用场景

*.cfg文件一般是程序运行的配置文件，如何正确使用cfg是程序员的必备技能，曾看过不规范的cfg使用方法，所以特地记录分享下。
python为读写常见配置文件提供了一个内置的`configparser`模块，所以在python中解析配置文件相当简单。

> 文档代码基于python3.7运行。

## 读取配置
现有示例配置`settings.cfg`文件，内容如下：
```
[db_config]
 
database_host = 192.168.X.X
 
database_port = 5432
 
database_name = DATABASE_NAME
 
database_username = test

[deploy]

project = product
```
然后通过python来读取配置：
```
import os
import configparser

CONFIG_FILE = 'settings.cfg'

def run():

    # 判断配置文件是否存在
    if os.path.exists(os.path.join(os.getcwd(), CONFIG_FILE)):
        config = configparser.ConfigParser()

        # 传入读取文件的地址，encoding文件编码格式，中文必须设为UTF-8
        config.read(CONFIG_FILE, encoding='UTF-8')

        #第一个参数指定要读取的段名，第二个是要读取的选项名

        # 获取db_config相关配置
        host = config.get("db_config", "database_host")
        
        # 获取deploy配置
        project = config.get("deploy", "project")

        # fallback参数可设置默认值, 在未获取到相关配置时返回
        url = config.get("deploy", "project", fallback='test.com')

        print(host, project, url)
        # 192.168.X.X product test.com

if __name__ == '__main__':
    run()
```

## 部署流程

设置git忽略`settings.cfg`文件，git只push配置文件的副本`settings.ini`文件，然后在服务器端交给运维来根据配置文件副本生成线上真正的`settings.cfg`文件。因为一些线上服务器的敏感配置是不能暴露的，如密钥、服务器ip密码那些，所以要交给运维来修改添加。
